-- Sub ScriptTrol




















local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Bladi Frenzy | V1 Beta Script",
   LoadingTitle = "OMG I HAVE 100 MUCH SUBSCRIBE",
   LoadingSubtitle = "by ChatGPT V4 and ScriptTrol",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "ScriptTrol Config"
   }
})

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Create Player Tab
local PlayerTab = Window:CreateTab("Player", 4483362458)

-- Infinite Stamina Toggle
PlayerTab:CreateToggle({
   Name = "Infinite Stamina",
   CurrentValue = true,
   Flag = "InfStamina",
   Callback = function(Value)
      _G.autoStamina = Value
      spawn(function()
         while _G.autoStamina do
            local PlayerFolder = workspace.Game.Players:FindFirstChild(LocalPlayer.Name)
            if PlayerFolder and PlayerFolder:FindFirstChild("Values") and PlayerFolder.Values:FindFirstChild("Stamina") then
               PlayerFolder.Values.Stamina.Value = 100
            end
            task.wait()
         end
      end)
   end,
})

-- Speed Boost Section
local SpeedSection = PlayerTab:CreateSection("Speed Boost")
_G.speedValue = 50
PlayerTab:CreateInput({
   Name = "Speed Value",
   PlaceholderText = "Enter speed value",
   RemoveTextAfterFocusLost = false,
   Callback = function(Text)
      local num = tonumber(Text)
      if num then _G.speedValue = num end
   end,
})

PlayerTab:CreateToggle({
   Name = "TPWalk (Speed Boost)",
   CurrentValue = false,
   Flag = "TPWalk",
   Callback = function(Value)
      _G.tpWalkEnabled = Value
      if not Value then return end
      local Character = LocalPlayer.Character
      local RootPart = Character and Character:FindFirstChild("HumanoidRootPart")
      if not RootPart then return end
      local lastPosition = RootPart.Position
      spawn(function()
         while _G.tpWalkEnabled do
            local Character = LocalPlayer.Character
            local RootPart = Character and Character:FindFirstChild("HumanoidRootPart")
            if not RootPart then task.wait(0.1) continue end
            local moveVector = Vector3.new(0,0,0)
            local cam = workspace.CurrentCamera
            local forward = cam.CFrame.LookVector
            local right = cam.CFrame.RightVector
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveVector = moveVector + forward end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveVector = moveVector - forward end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveVector = moveVector - right end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveVector = moveVector + right end
            if moveVector.Magnitude > 0 then
               moveVector = moveVector.Unit
               local newPos = lastPosition + (moveVector * _G.speedValue * 0.016)
               RootPart.CFrame = CFrame.new(newPos, newPos + forward)
               lastPosition = newPos
            end
            task.wait()
         end
      end)
   end,
})

-- === PLAYER ESP ===
local PlayerESPSection = PlayerTab:CreateSection("Player ESP")
PlayerTab:CreateToggle({Name="Player ESP Enabled",CurrentValue=false,Flag="PESP",Callback=function(v) _G.playerEspEnabled=v end})
PlayerTab:CreateToggle({Name="Player Chams",CurrentValue=false,Flag="PChams",Callback=function(v) _G.playerChamsEnabled=v end})
PlayerTab:CreateToggle({Name="Player Box",CurrentValue=false,Flag="PBox",Callback=function(v) _G.playerBoxEnabled=v end})
PlayerTab:CreateToggle({Name="Player Name",CurrentValue=false,Flag="PName",Callback=function(v) _G.playerNameEnabled=v end})
PlayerTab:CreateToggle({Name="Player Line",CurrentValue=false,Flag="PLine",Callback=function(v) _G.playerLineEnabled=v end})
PlayerTab:CreateToggle({Name="Player Team Check",CurrentValue=false,Flag="PTeam",Callback=function(v) _G.playerTeamCheck=v end})
local PlayerESPColor = Color3.fromRGB(255,0,0)
PlayerTab:CreateColorPicker({Name="Player ESP Color",Color=PlayerESPColor,Callback=function(v) PlayerESPColor=v end})

-- === ITEM ESP ===
local ItemESPSection = PlayerTab:CreateSection("Item ESP")
PlayerTab:CreateToggle({Name="Item ESP Enabled",CurrentValue=false,Flag="IESP",Callback=function(v) _G.itemEspEnabled=v end})
PlayerTab:CreateToggle({Name="Item Chams",CurrentValue=false,Flag="IChams",Callback=function(v) _G.itemChamsEnabled=v end})
PlayerTab:CreateToggle({Name="Item Box",CurrentValue=false,Flag="IBox",Callback=function(v) _G.itemBoxEnabled=v end})
PlayerTab:CreateToggle({Name="Item Name",CurrentValue=false,Flag="IName",Callback=function(v) _G.itemNameEnabled=v end})
PlayerTab:CreateToggle({Name="Item Line",CurrentValue=false,Flag="ILine",Callback=function(v) _G.itemLineEnabled=v end})
local ItemESPColor = Color3.fromRGB(0,255,0)
PlayerTab:CreateColorPicker({Name="Item ESP Color",Color=ItemESPColor,Callback=function(v) ItemESPColor=v end})

-- === NOTEBOOK ESP ===
local NotebookESPSection = PlayerTab:CreateSection("Notebook ESP")
PlayerTab:CreateToggle({Name="Notebook ESP Enabled",CurrentValue=false,Flag="NESP",Callback=function(v) _G.notebookEspEnabled=v end})
PlayerTab:CreateToggle({Name="Notebook Chams",CurrentValue=false,Flag="NChams",Callback=function(v) _G.notebookChamsEnabled=v end})
PlayerTab:CreateToggle({Name="Notebook Box",CurrentValue=false,Flag="NBox",Callback=function(v) _G.notebookBoxEnabled=v end})
PlayerTab:CreateToggle({Name="Notebook Name",CurrentValue=false,Flag="NName",Callback=function(v) _G.notebookNameEnabled=v end})
PlayerTab:CreateToggle({Name="Notebook Line",CurrentValue=false,Flag="NLine",Callback=function(v) _G.notebookLineEnabled=v end})
local NotebookESPColor = Color3.fromRGB(0,0,255)
PlayerTab:CreateColorPicker({Name="Notebook ESP Color",Color=NotebookESPColor,Callback=function(v) NotebookESPColor=v end})

-- ESP Tables
local PlayerESPs, ItemESPs, NotebookESPs = {},{},{}

-- Create ESP functions
local function CreatePlayerESP(p) 
   if PlayerESPs[p] then return end
   local h = Instance.new("Highlight",p) h.Name="Chams" h.FillTransparency=0.5 h.Enabled=false
   local b = Drawing.new("Square") b.Thickness=2 b.Filled=false b.Visible=false
   local n = Drawing.new("Text") n.Size=16 n.Center=true n.Outline=true n.Text=p.Name n.Visible=false
   local t = Drawing.new("Line") t.Thickness=1 t.Visible=false
   PlayerESPs[p] = {Highlight=h,Box=b,Name=n,Tracer=t}
end

local function CreateItemESP(i) 
   if ItemESPs[i] then return end
   local h = Instance.new("Highlight",i) h.Name="ItemChams" h.FillTransparency=0.5 h.Enabled=false
   local b = Drawing.new("Square") b.Thickness=2 b.Filled=false b.Visible=false
   local n = Drawing.new("Text") n.Size=16 n.Center=true n.Outline=true n.Text=i.Name n.Visible=false
   local t = Drawing.new("Line") t.Thickness=1 t.Visible=false
   ItemESPs[i] = {Highlight=h,Box=b,Name=n,Tracer=t}
end

local function CreateNotebookESP(n) 
   if NotebookESPs[n] then return end
   local h = Instance.new("Highlight",n) h.Name="NotebookChams" h.FillTransparency=0.5 h.Enabled=false
   local b = Drawing.new("Square") b.Thickness=2 b.Filled=false b.Visible=false
   local n = Drawing.new("Text") n.Size=16 n.Center=true n.Outline=true n.Text=n.Name n.Visible=false
   local t = Drawing.new("Line") t.Thickness=1 t.Visible=false
   NotebookESPs[n] = {Highlight=h,Box=b,Name=n,Tracer=t}
end

-- Update ESP
local function UpdateAllESP()
   -- Players
   for obj,esp in pairs(PlayerESPs) do
      if not obj or not obj.Parent then 
         if esp.Box then esp.Box:Remove() end 
         if esp.Name then esp.Name:Remove() end 
         if esp.Tracer then esp.Tracer:Remove() end 
         if esp.Highlight then esp.Highlight:Destroy() end 
         PlayerESPs[obj]=nil 
         continue 
      end
      local hrp = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChild("Torso")
      local head = obj:FindFirstChild("Head")
      local hum = obj:FindFirstChild("Humanoid")
      if not (hrp and head and hum and hum.Health>0 and obj.Name~=LocalPlayer.Name) then
         esp.Box.Visible=false esp.Name.Visible=false esp.Tracer.Visible=false esp.Highlight.Enabled=false continue
      end
      local teammate = _G.playerTeamCheck and Players[obj.Name] and Players[obj.Name].Team==LocalPlayer.Team
      if not _G.playerEspEnabled or teammate then
         esp.Box.Visible=false esp.Name.Visible=false esp.Tracer.Visible=false esp.Highlight.Enabled=false continue
      end
      esp.Highlight.FillColor=PlayerESPColor esp.Highlight.OutlineColor=PlayerESPColor
      esp.Box.Color=PlayerESPColor esp.Name.Color=PlayerESPColor esp.Tracer.Color=PlayerESPColor
      esp.Highlight.Enabled=_G.playerChamsEnabled
      local pos,onScreen = Camera:WorldToViewportPoint(hrp.Position)
      if onScreen then
         if _G.playerBoxEnabled then
            local top = Camera:WorldToViewportPoint(head.Position+Vector3.new(0,0.5,0))
            local bot = Camera:WorldToViewportPoint(hrp.Position-Vector3.new(0,4,0))
            esp.Box.Size=Vector2.new(2000/pos.Z,top.Y-bot.Y)
            esp.Box.Position=Vector2.new(pos.X-esp.Box.Size.X/2,bot.Y)
            esp.Box.Visible=true
         else esp.Box.Visible=false end
         if _G.playerNameEnabled then esp.Name.Position=Vector2.new(pos.X,pos.Y-20) esp.Name.Visible=true else esp.Name.Visible=false end
         if _G.playerLineEnabled then esp.Tracer.From=Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y) esp.Tracer.To=Vector2.new(pos.X,pos.Y) esp.Tracer.Visible=true else esp.Tracer.Visible=false end
      else
         esp.Box.Visible=false esp.Name.Visible=false esp.Tracer.Visible=false esp.Highlight.Enabled=false
      end
   end

   -- Items
   for obj,esp in pairs(ItemESPs) do
      if not obj or not obj.Parent then 
         if esp.Box then esp.Box:Remove() end 
         if esp.Name then esp.Name:Remove() end 
         if esp.Tracer then esp.Tracer:Remove() end 
         if esp.Highlight then esp.Highlight:Destroy() end 
         ItemESPs[obj]=nil 
         continue 
      end
      local part = obj:FindFirstChild("InteractionHitbox") or obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
      if not part then continue end
      if not _G.itemEspEnabled then esp.Box.Visible=false esp.Name.Visible=false esp.Tracer.Visible=false esp.Highlight.Enabled=false continue end
      esp.Highlight.FillColor=ItemESPColor esp.Highlight.OutlineColor=ItemESPColor
      esp.Box.Color=ItemESPColor esp.Name.Color=ItemESPColor esp.Tracer.Color=ItemESPColor
      esp.Highlight.Enabled=_G.itemChamsEnabled
      local pos,onScreen = Camera:WorldToViewportPoint(part.Position)
      if onScreen then
         if _G.itemBoxEnabled then
            local s = part.Size or Vector3.new(1,1,1)
            local top = Camera:WorldToViewportPoint(part.Position+Vector3.new(0,s.Y/2,0))
            local bot = Camera:WorldToViewportPoint(part.Position-Vector3.new(0,s.Y/2,0))
            esp.Box.Size=Vector2.new(2000/pos.Z*s.X,top.Y-bot.Y)
            esp.Box.Position=Vector2.new(pos.X-esp.Box.Size.X/2,bot.Y)
            esp.Box.Visible=true
         else esp.Box.Visible=false end
         if _G.itemNameEnabled then esp.Name.Position=Vector2.new(pos.X,pos.Y-20) esp.Name.Visible=true else esp.Name.Visible=false end
         if _G.itemLineEnabled then esp.Tracer.From=Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y) esp.Tracer.To=Vector2.new(pos.X,pos.Y) esp.Tracer.Visible=true else esp.Tracer.Visible=false end
      else
         esp.Box.Visible=false esp.Name.Visible=false esp.Tracer.Visible=false esp.Highlight.Enabled=false
      end
   end

   -- Notebooks
   for obj,esp in pairs(NotebookESPs) do
      if not obj or not obj.Parent then 
         if esp.Box then esp.Box:Remove() end 
         if esp.Name then esp.Name:Remove() end 
         if esp.Tracer then esp.Tracer:Remove() end 
         if esp.Highlight then esp.Highlight:Destroy() end 
         NotebookESPs[obj]=nil 
         continue 
      end
      local part = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
      if not part then continue end
      if not _G.notebookEspEnabled then esp.Box.Visible=false esp.Name.Visible=false esp.Tracer.Visible=false esp.Highlight.Enabled=false continue end
      esp.Highlight.FillColor=NotebookESPColor esp.Highlight.OutlineColor=NotebookESPColor
      esp.Box.Color=NotebookESPColor esp.Name.Color=NotebookESPColor esp.Tracer.Color=NotebookESPColor
      esp.Highlight.Enabled=_G.notebookChamsEnabled
      local pos,onScreen = Camera:WorldToViewportPoint(part.Position)
      if onScreen then
         if _G.notebookBoxEnabled then
            local s = part.Size or Vector3.new(1,1,1)
            local top = Camera:WorldToViewportPoint(part.Position+Vector3.new(0,s.Y/2,0))
            local bot = Camera:WorldToViewportPoint(part.Position-Vector3.new(0,s.Y/2,0))
            esp.Box.Size=Vector2.new(2000/pos.Z*s.X,top.Y-bot.Y)
            esp.Box.Position=Vector2.new(pos.X-esp.Box.Size.X/2,bot.Y)
            esp.Box.Visible=true
         else esp.Box.Visible=false end
         if _G.notebookNameEnabled then esp.Name.Position=Vector2.new(pos.X,pos.Y-20) esp.Name.Visible=true else esp.Name.Visible=false end
         if _G.notebookLineEnabled then esp.Tracer.From=Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y) esp.Tracer.To=Vector2.new(pos.X,pos.Y) esp.Tracer.Visible=true else esp.Tracer.Visible=false end
      else
         esp.Box.Visible=false esp.Name.Visible=false esp.Tracer.Visible=false esp.Highlight.Enabled=false
      end
   end
end

-- Connect ESP creation
local function ConnectFolder(folder, createFunc)
   if folder then
      folder.ChildAdded:Connect(createFunc)
      for _,v in folder:GetChildren() do createFunc(v) end
   end
end

-- Wait for folders and connect
spawn(function()
   local itemFolder = workspace.Game.Map:WaitForChild("Item", 10)
   local notebookFolder = workspace.Game.Map:WaitForChild("Notebooks", 10)
   ConnectFolder(itemFolder, CreateItemESP)
   ConnectFolder(notebookFolder, CreateNotebookESP)
end)

workspace.Game.Players.ChildAdded:Connect(CreatePlayerESP)
for _,v in workspace.Game.Players:GetChildren() do CreatePlayerESP(v) end

RunService.RenderStepped:Connect(UpdateAllESP)

-- === MAP TAB ===
local MapTab = Window:CreateTab("Map", 4483362458)

-- Fixed item list function with wait
local function GetAllItems()
   local list = {}
   pcall(function()
      local folder = workspace.Game.Map:WaitForChild("Item", 10)
      if folder then
         task.wait(1) -- Extra wait for items to fully load
         for _,obj in pairs(folder:GetChildren()) do
            if obj:IsA("Model") or obj:IsA("BasePart") then
               table.insert(list, obj.Name)
            end
         end
      end
   end)
   return list
end

-- Initial load with wait
spawn(function()
   task.wait(3) -- Wait for map to fully load
   local items = GetAllItems()
   ItemDropdown:Refresh(items, true)
   if #items > 0 then
      _G.selectedItem = items[1]
      ItemDropdown:Set(items[1])
   end
end)

-- Dropdown
local ItemDropdown = MapTab:CreateDropdown({
   Name = "Select Item",
   Options = {"Loading..."},
   CurrentOption = "Loading...",
   Flag = "SelItem",
   Callback = function(opt) _G.selectedItem = opt end
})

-- Refresh button (NOW WORKS with better checks)
MapTab:CreateButton({
   Name = "Refresh Items",
   Callback = function()
      Rayfield:Notify({Title="Loading",Content="Scanning for items...",Duration=1})
      local items = GetAllItems()
      if #items > 0 then
         ItemDropdown:Refresh(items, true)
         _G.selectedItem = items[1]
         ItemDropdown:Set(items[1])
         Rayfield:Notify({Title="Success",Content=#items.." items loaded!",Duration=2})
      else
         ItemDropdown:Refresh({"No items found"}, true)
         _G.selectedItem = nil
         Rayfield:Notify({Title="Info",Content="No items in map yet. Try again later.",Duration=2})
      end
   end,
})

-- Get Item (TP to item, NO TP BACK)
MapTab:CreateButton({
   Name = "Get Selected Item",
   Callback = function()
      if _G.selectedItem and workspace.Game.Map:FindFirstChild("Item") and workspace.Game.Map.Item:FindFirstChild(_G.selectedItem) then
         local item = workspace.Game.Map.Item[_G.selectedItem]
         local part = item:FindFirstChild("InteractionHitbox") or item.PrimaryPart or item:FindFirstChildWhichIsA("BasePart")
         if part and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(part.Position + Vector3.new(0, 3, 0)) -- Slight Y offset to avoid clipping
            Rayfield:Notify({Title="Teleported",Content="You are now at ".._G.selectedItem,Duration=2})
         else
            Rayfield:Notify({Title="Error",Content="Item has no valid part!",Duration=3})
         end
      else
         Rayfield:Notify({Title="Error",Content="Select valid item first or map not loaded!",Duration=3})
      end
   end,
})

-- Remove Doors (Improved detection)
MapTab:CreateButton({
   Name = "Remove All Doors",
   Callback = function()
      pcall(function()
         local map = workspace.Game:FindFirstChild("Map")
         if map then
            for _,obj in pairs(map:GetChildren()) do
               if obj.Name:lower():find("door") or obj:IsA("Model") and obj:FindFirstChild("Door") then
                  obj:Destroy()
               end
            end
            Rayfield:Notify({Title="Success",Content="All doors removed!",Duration=2})
         else
            Rayfield:Notify({Title="Error",Content="Map not found!",Duration=2})
         end
      end)
   end,
})

local ScriptTab = Window:CreateTab("More", 4483362458) -- Title, Image

local Button = ScriptTab:CreateButton({
   Name = "lnfinite yield",
   Callback = function()
   loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
   end,
})
