-- Sub ScriptTrol









-- V2














local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Bladi Frenzy | V2 Beta Script",
   LoadingTitle = "OMG I HAVE 100 MUCH SUBSCRIBE",
   LoadingSubtitle = "by ChatGPT V4, Deepseek, grok (MVP) and ScriptTrol (Stupid)",
   ConfigurationSaving = { Enabled = true, FolderName = nil, FileName = "ScriptTrol Config" }
})

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- === TABS ===
local PlayerTab = Window:CreateTab("Player", 4483362458)
local MapTab = Window:CreateTab("Map", 4483362458)
local ScriptTab = Window:CreateTab("More", 4483362458)

-- === FULLBRIGHT ===
local originalBrightness, originalFogEnd, originalGlobalShadows = Lighting.Brightness, Lighting.FogEnd, Lighting.GlobalShadows
PlayerTab:CreateToggle({
   Name = "Fullbright",
   CurrentValue = false,
   Flag = "Fullbright",
   Callback = function(v)
      _G.fullbrightEnabled = v
      pcall(function()
         if v then
            Lighting.Brightness = 2
            Lighting.FogEnd = 1000000
            Lighting.GlobalShadows = false
         else
            Lighting.Brightness = originalBrightness
            Lighting.FogEnd = originalFogEnd
            Lighting.GlobalShadows = originalGlobalShadows
         end
      end)
   end
})

-- === INFINITE STAMINA & TPWALK ===
PlayerTab:CreateToggle({
   Name = "Infinite Stamina",
   CurrentValue = true,
   Flag = "InfStamina",
   Callback = function(v)
      _G.autoStamina = v
      spawn(function()
         while _G.autoStamina do
            local pf = workspace.Game.Players:FindFirstChild(LocalPlayer.Name)
            if pf and pf:FindFirstChild("Values") and pf.Values:FindFirstChild("Stamina") then
               pf.Values.Stamina.Value = 100
            end
            task.wait()
         end
      end)
   end,
})

_G.speedValue = 50
PlayerTab:CreateInput({
   Name = "Speed Value",
   PlaceholderText = "Enter speed value",
   RemoveTextAfterFocusLost = false,
   Callback = function(Text)
      local num = tonumber(Text)
      if num then
         _G.speedValue = num
      end
   end,
})

PlayerTab:CreateToggle({
   Name = "TPWalk (Speed Boost)",
   CurrentValue = false,
   Flag = "TPWalk",
   Callback = function(Value)
      _G.tpWalkEnabled = Value
      if not Value then return end
      local Character = LocalPlayer.Character
      local RootPart = Character and Character:FindFirstChild("HumanoidRootPart")
      if not RootPart then return end
      local lastPosition = RootPart.Position
      spawn(function()
         while _G.tpWalkEnabled do
            local Character = LocalPlayer.Character
            local RootPart = Character and Character:FindFirstChild("HumanoidRootPart")
            if not RootPart then task.wait(0.1) continue end
            local moveVector = Vector3.new(0, 0, 0)
            local camera = workspace.CurrentCamera
            local forward = camera.CFrame.LookVector
            local right = camera.CFrame.RightVector
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
               moveVector = moveVector + forward
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
               moveVector = moveVector - forward
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
               moveVector = moveVector - right
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
               moveVector = moveVector + right
            end
            if moveVector.Magnitude > 0 then
               moveVector = moveVector.Unit
               local newPosition = lastPosition + (moveVector * _G.speedValue * 0.016)  -- Delta time approx
               RootPart.CFrame = CFrame.new(newPosition, newPosition + forward)
               lastPosition = newPosition
            end
            task.wait()
         end
      end)
   end,
})

-- === PLAYER ESP ===
local PlayerESPSection = PlayerTab:CreateSection("Player ESP")
PlayerTab:CreateToggle({Name="Player ESP Enabled",CurrentValue=false,Flag="PESP",Callback=function(v) _G.playerEspEnabled=v end})
PlayerTab:CreateToggle({Name="Player Chams",CurrentValue=false,Flag="PChams",Callback=function(v) _G.playerChamsEnabled=v end})
PlayerTab:CreateToggle({Name="Player Box",CurrentValue=false,Flag="PBox",Callback=function(v) _G.playerBoxEnabled=v end})
PlayerTab:CreateToggle({Name="Player Name",CurrentValue=false,Flag="PName",Callback=function(v) _G.playerNameEnabled=v end})
PlayerTab:CreateToggle({Name="Player Line",CurrentValue=false,Flag="PLine",Callback=function(v) _G.playerLineEnabled=v end})
PlayerTab:CreateToggle({Name="Player Team Check",CurrentValue=false,Flag="PTeam",Callback=function(v) _G.playerTeamCheck=v end})
local PlayerESPColor = Color3.fromRGB(255,0,0)
PlayerTab:CreateColorPicker({Name="Player ESP Color",Color=PlayerESPColor,Callback=function(v) PlayerESPColor=v end})

-- === ITEM ESP ===
local ItemESPSection = PlayerTab:CreateSection("Item ESP")
PlayerTab:CreateToggle({Name="Item ESP Enabled",CurrentValue=false,Flag="IESP",Callback=function(v) _G.itemEspEnabled=v end})
PlayerTab:CreateToggle({Name="Item Chams",CurrentValue=false,Flag="IChams",Callback=function(v) _G.itemChamsEnabled=v end})
PlayerTab:CreateToggle({Name="Item Box",CurrentValue=false,Flag="IBox",Callback=function(v) _G.itemBoxEnabled=v end})
PlayerTab:CreateToggle({Name="Item Name",CurrentValue=false,Flag="IName",Callback=function(v) _G.itemNameEnabled=v end})
PlayerTab:CreateToggle({Name="Item Line",CurrentValue=false,Flag="ILine",Callback=function(v) _G.itemLineEnabled=v end})
local ItemESPColor = Color3.fromRGB(0,255,0)
PlayerTab:CreateColorPicker({Name="Item ESP Color",Color=ItemESPColor,Callback=function(v) ItemESPColor=v end})

-- === NOTEBOOK ESP ===
local NotebookESPSection = PlayerTab:CreateSection("Notebook ESP")
PlayerTab:CreateToggle({Name="Notebook ESP Enabled",CurrentValue=false,Flag="NESP",Callback=function(v) _G.notebookEspEnabled=v end})
PlayerTab:CreateToggle({Name="Notebook Chams",CurrentValue=false,Flag="NChams",Callback=function(v) _G.notebookChamsEnabled=v end})
PlayerTab:CreateToggle({Name="Notebook Box",CurrentValue=false,Flag="NBox",Callback=function(v) _G.notebookBoxEnabled=v end})
PlayerTab:CreateToggle({Name="Notebook Name",CurrentValue=false,Flag="NName",Callback=function(v) _G.notebookNameEnabled=v end})
PlayerTab:CreateToggle({Name="Notebook Line",CurrentValue=false,Flag="NLine",Callback=function(v) _G.notebookLineEnabled=v end})
local NotebookESPColor = Color3.fromRGB(0,0,255)
PlayerTab:CreateColorPicker({Name="Notebook ESP Color",Color=NotebookESPColor,Callback=function(v) NotebookESPColor=v end})

-- === ESP TABLES ===
local PlayerESPs = {}
local ItemESPs = {}
local NotebookESPs = {}

-- === CREATE ESP ===
local function CreateESP(tbl, parent, colorVar, name)
   if tbl[parent] then return end
   local h = Instance.new("Highlight", parent)
   h.Name = name.."Chams" h.FillTransparency = 0.5 h.Enabled = false
   local box = Drawing.new("Square") box.Thickness = 2 box.Filled = false box.Visible = false
   local txt = Drawing.new("Text") txt.Size = 16 txt.Center = true txt.Outline = true txt.Text = parent.Name txt.Visible = false
   local line = Drawing.new("Line") line.Thickness = 1 line.Visible = false
   tbl[parent] = {Highlight=h, Box=box, Name=txt, Tracer=line, ColorVar=colorVar}
end

local function CreatePlayerESP(p) CreateESP(PlayerESPs, p, PlayerESPColor, "Player") end
local function CreateItemESP(i) CreateESP(ItemESPs, i, ItemESPColor, "Item") end
local function CreateNotebookESP(n) CreateESP(NotebookESPs, n, NotebookESPColor, "Notebook") end

-- === UPDATE ESP ===
local function UpdateAllESP()
   pcall(function()
      local cam = workspace.CurrentCamera
      local gameFolder = workspace:FindFirstChild("Game")
      if not gameFolder then return end
      local map = gameFolder:FindFirstChild("Map")
      if not map then return end
      local itemFolder = map:FindFirstChild("Item")
      local notebookFolder = map:FindFirstChild("Notebooks")

      -- Update Player ESP
      if _G.playerEspEnabled then
         for _, player in pairs(workspace.Game.Players:GetChildren()) do
            if not PlayerESPs[player] and player.Name ~= LocalPlayer.Name then CreatePlayerESP(player) end
         end
      end
      for obj, e in pairs(PlayerESPs) do
         if not obj or not obj.Parent or not _G.playerEspEnabled then
            e.Box:Remove() e.Name:Remove() e.Tracer:Remove() e.Highlight:Destroy() PlayerESPs[obj]=nil
            continue
         end
         local hrp = obj:FindFirstChild("HumanoidRootPart")
         local head = obj:FindFirstChild("Head")
         local hum = obj:FindFirstChild("Humanoid")
         if not (hrp and head and hum and hum.Health > 0 and obj.Name ~= LocalPlayer.Name) then
            e.Box.Visible = false e.Name.Visible = false e.Tracer.Visible = false e.Highlight.Enabled = false
            continue
         end
         local isTeammate = false
         pcall(function()
            isTeammate = Players[obj.Name].Team == LocalPlayer.Team
         end)
         if _G.playerTeamCheck and isTeammate then
            e.Box.Visible = false e.Name.Visible = false e.Tracer.Visible = false e.Highlight.Enabled = false
            continue
         end
         e.Highlight.FillColor = PlayerESPColor e.Highlight.OutlineColor = PlayerESPColor
         e.Box.Color = PlayerESPColor e.Name.Color = PlayerESPColor e.Tracer.Color = PlayerESPColor
         e.Highlight.Enabled = _G.playerChamsEnabled

         local pos, onScreen = cam:WorldToViewportPoint(hrp.Position)
         if onScreen then
            if _G.playerBoxEnabled then
               local top = cam:WorldToViewportPoint(head.Position + Vector3.new(0,0.5,0)).Y
               local bot = cam:WorldToViewportPoint(hrp.Position - Vector3.new(0,4,0)).Y
               e.Box.Size = Vector2.new(2000/pos.Z, top-bot)
               e.Box.Position = Vector2.new(pos.X - e.Box.Size.X/2, bot)
               e.Box.Visible = true
            else e.Box.Visible = false end
            if _G.playerNameEnabled then e.Name.Position = Vector2.new(pos.X, pos.Y-20) e.Name.Visible = true else e.Name.Visible = false end
            if _G.playerLineEnabled then e.Tracer.From = Vector2.new(cam.ViewportSize.X/2, cam.ViewportSize.Y) e.Tracer.To = Vector2.new(pos.X, pos.Y) e.Tracer.Visible = true else e.Tracer.Visible = false end
         else
            e.Box.Visible = false e.Name.Visible = false e.Tracer.Visible = false e.Highlight.Enabled = false
         end
      end

      -- Update Item ESP
      if itemFolder and _G.itemEspEnabled then
         for _, item in pairs(itemFolder:GetChildren()) do
            if item.Name ~= "SwappingPlots" and not ItemESPs[item] then CreateItemESP(item) end
         end
         local swappingPlots = itemFolder:FindFirstChild("SwappingPlots")
         if swappingPlots then
            for _, subItem in pairs(swappingPlots:GetChildren()) do
               if not ItemESPs[subItem] then CreateItemESP(subItem) end
            end
         end
      end
      for obj, e in pairs(ItemESPs) do
         if not obj or not obj.Parent or not _G.itemEspEnabled then
            e.Box:Remove() e.Name:Remove() e.Tracer:Remove() e.Highlight:Destroy() ItemESPs[obj]=nil
            continue
         end
         local part = obj:FindFirstChild("InteractionHitbox")
         if not part then
            continue
         end
         local pos = part.Position
         e.Highlight.FillColor = ItemESPColor e.Highlight.OutlineColor = ItemESPColor
         e.Box.Color = ItemESPColor e.Name.Color = ItemESPColor e.Tracer.Color = ItemESPColor
         e.Highlight.Enabled = _G.itemChamsEnabled

         local screenPos, onScreen = cam:WorldToViewportPoint(pos)
         if onScreen then
            if _G.itemBoxEnabled then
               local s = part.Size or Vector3.new(1,1,1)
               local top = cam:WorldToViewportPoint(pos + Vector3.new(0,s.Y/2,0)).Y
               local bot = cam:WorldToViewportPoint(pos - Vector3.new(0,s.Y/2,0)).Y
               e.Box.Size = Vector2.new(2000/screenPos.Z * s.X, top-bot)
               e.Box.Position = Vector2.new(screenPos.X - e.Box.Size.X/2, bot)
               e.Box.Visible = true
            else e.Box.Visible = false end
            if _G.itemNameEnabled then e.Name.Position = Vector2.new(screenPos.X, screenPos.Y-20) e.Name.Visible = true else e.Name.Visible = false end
            if _G.itemLineEnabled then e.Tracer.From = Vector2.new(cam.ViewportSize.X/2, cam.ViewportSize.Y) e.Tracer.To = Vector2.new(screenPos.X, screenPos.Y) e.Tracer.Visible = true else e.Tracer.Visible = false end
         else
            e.Box.Visible = false e.Name.Visible = false e.Tracer.Visible = false e.Highlight.Enabled = false
         end
      end

      -- Update Notebook ESP
      if notebookFolder and _G.notebookEspEnabled then
         for _, notebook in pairs(notebookFolder:GetChildren()) do
            if not NotebookESPs[notebook] then CreateNotebookESP(notebook) end
         end
      end
      for obj, e in pairs(NotebookESPs) do
         if not obj or not obj.Parent or not _G.notebookEspEnabled then
            e.Box:Remove() e.Name:Remove() e.Tracer:Remove() e.Highlight:Destroy() NotebookESPs[obj]=nil
            continue
         end
         local part = obj:FindFirstChild("InteractionHitbox") or obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart") or obj
         local pos = (part:IsA("BasePart") and part.Position) or obj:GetPivot().Position
         if not pos then
            continue
         end
         e.Highlight.FillColor = NotebookESPColor e.Highlight.OutlineColor = NotebookESPColor
         e.Box.Color = NotebookESPColor e.Name.Color = NotebookESPColor e.Tracer.Color = NotebookESPColor
         e.Highlight.Enabled = _G.notebookChamsEnabled

         local screenPos, onScreen = cam:WorldToViewportPoint(pos)
         if onScreen then
            if _G.notebookBoxEnabled then
               local s = (part:IsA("BasePart") and part.Size) or Vector3.new(1,1,1)
               local top = cam:WorldToViewportPoint(pos + Vector3.new(0,s.Y/2,0)).Y
               local bot = cam:WorldToViewportPoint(pos - Vector3.new(0,s.Y/2,0)).Y
               e.Box.Size = Vector2.new(2000/screenPos.Z * s.X, top-bot)
               e.Box.Position = Vector2.new(screenPos.X - e.Box.Size.X/2, bot)
               e.Box.Visible = true
            else e.Box.Visible = false end
            if _G.notebookNameEnabled then e.Name.Position = Vector2.new(screenPos.X, screenPos.Y-20) e.Name.Visible = true else e.Name.Visible = false end
            if _G.notebookLineEnabled then e.Tracer.From = Vector2.new(cam.ViewportSize.X/2, cam.ViewportSize.Y) e.Tracer.To = Vector2.new(screenPos.X, screenPos.Y) e.Tracer.Visible = true else e.Tracer.Visible = false end
         else
            e.Box.Visible = false e.Name.Visible = false e.Tracer.Visible = false e.Highlight.Enabled = false
         end
      end
   end)
end

RunService.RenderStepped:Connect(UpdateAllESP)

-- === DYNAMIC MAP HANDLING ===
local function ClearAll()
   for _,e in pairs(ItemESPs) do e.Highlight:Destroy() e.Box:Remove() e.Name:Remove() e.Tracer:Remove() end
   for _,e in pairs(NotebookESPs) do e.Highlight:Destroy() e.Box:Remove() e.Name:Remove() e.Tracer:Remove() end
   ItemESPs, NotebookESPs = {}, {}
   ItemDropdown:Refresh({"Waiting for new map..."}, true)
   _G.selectedItem = nil
end

local function SetupMap(map)
   ClearAll() -- Clear old data
   pcall(function()
      local itemFolder = map:FindFirstChild("Item") or map:WaitForChild("Item", 5)
      local notebookFolder = map:FindFirstChild("Notebooks") or map:WaitForChild("Notebooks", 5)

      if itemFolder then
         itemFolder.ChildAdded:Connect(function(child)
            if child.Name ~= "SwappingPlots" and child:FindFirstChild("InteractionHitbox") then
               CreateItemESP(child)
               MapTab:CreateButton({Name="Refresh Items",Callback=function() end})() -- Auto-refresh dropdown
            end
         end)
         itemFolder.ChildRemoved:Connect(function(c)
            if ItemESPs[c] then
               ItemESPs[c].Highlight:Destroy()
               ItemESPs[c].Box:Remove()
               ItemESPs[c].Name:Remove()
               ItemESPs[c].Tracer:Remove()
               ItemESPs[c]=nil
               MapTab:CreateButton({Name="Refresh Items",Callback=function() end})() -- Auto-refresh dropdown
            end
         end)
         for _,v in pairs(itemFolder:GetChildren()) do
            if v.Name ~= "SwappingPlots" and v:FindFirstChild("InteractionHitbox") then CreateItemESP(v) end
         end
      end

      if notebookFolder then
         notebookFolder.ChildAdded:Connect(function(child)
            CreateNotebookESP(child)
         end)
         notebookFolder.ChildRemoved:Connect(function(c)
            if NotebookESPs[c] then
               NotebookESPs[c].Highlight:Destroy()
               NotebookESPs[c].Box:Remove()
               NotebookESPs[c].Name:Remove()
               NotebookESPs[c].Tracer:Remove()
               NotebookESPs[c]=nil
            end
         end)
         for _,v in pairs(notebookFolder:GetChildren()) do CreateNotebookESP(v) end
      end

      -- Initial item load
      local items = {}
      if itemFolder then
         for _,obj in pairs(itemFolder:GetChildren()) do
            if obj.Parent and obj.Name ~= "SwappingPlots" and obj:FindFirstChild("InteractionHitbox") then
               table.insert(items, obj.Name)
            end
         end
      end
      ItemDropdown:Refresh(items, true)
      if #items > 0 then
         _G.selectedItem = items[1]
         ItemDropdown:Set(items[1])
      else
         ItemDropdown:Refresh({"No items yet"}, true)
      end
   end)
end

-- Monitor map changes
local connections = {}
local function DisconnectAll()
   for _, conn in pairs(connections) do conn:Disconnect() end
   connections = {}
end

spawn(function()
   while true do
      pcall(function()
         local gameFolder = workspace:WaitForChild("Game", 5)
         if not gameFolder then
            ClearAll()
            return
         end
         local map = gameFolder:FindFirstChild("Map") or gameFolder:WaitForChild("Map", 5)
         if map then
            SetupMap(map)
            local mapConnection = map.AncestryChanged:Connect(function()
               if not map.Parent then
                  DisconnectAll()
                  ClearAll()
               end
            end)
            local childRemovedConnection = map.ChildRemoved:Connect(function(child)
               if child.Name == "Item" or child.Name == "Notebooks" then
                  ClearAll()
               end
            end)
            table.insert(connections, mapConnection)
            table.insert(connections, childRemovedConnection)
         else
            ClearAll()
         end
         local addedConnection = gameFolder.ChildAdded:Connect(function(child)
            if child.Name == "Map" then
               DisconnectAll()
               ClearAll()
               SetupMap(child)
            end
         end)
         table.insert(connections, addedConnection)
         local gameFolderConnection = gameFolder.AncestryChanged:Connect(function()
            if not gameFolder.Parent then
               DisconnectAll()
               ClearAll()
            end
         end)
         table.insert(connections, gameFolderConnection)
      end)
      task.wait(0.1) -- Fast check for map changes
   end
end)

-- Players
pcall(function()
   local playersFolder = workspace:FindFirstChild("Game") and workspace.Game:FindFirstChild("Players")
   if playersFolder then
      playersFolder.ChildAdded:Connect(CreatePlayerESP)
      for _,v in pairs(playersFolder:GetChildren()) do CreatePlayerESP(v) end
   end
end)

-- === MAP TAB - ITEM LIST & TP ===
local ItemDropdown = MapTab:CreateDropdown({
   Name = "Select Item",
   Options = {"Waiting for map..."},
   CurrentOption = "Waiting for map...",
   Callback = function(v) _G.selectedItem = v end
})

MapTab:CreateButton({
   Name = "Refresh Items",
   Callback = function()
      local items = {}
      pcall(function()
         local gameFolder = workspace:FindFirstChild("Game")
         if not gameFolder then
            return
         end
         local map = gameFolder:FindFirstChild("Map")
         if not map then
            return
         end
         local folder = map:FindFirstChild("Item")
         if not folder then
            return
         end
         for _,obj in pairs(folder:GetChildren()) do
            if obj.Parent and obj.Name ~= "SwappingPlots" and obj:FindFirstChild("InteractionHitbox") then
               table.insert(items, obj.Name)
            end
         end
      end)
      if #items > 0 then
         ItemDropdown:Refresh(items, true)
         _G.selectedItem = items[1]
         ItemDropdown:Set(items[1])
      else
         ItemDropdown:Refresh({"No items yet"}, true)
         _G.selectedItem = nil
      end
   end
})

MapTab:CreateButton({
   Name = "Get Selected Item (TP TO ITEM)",
   Callback = function()
      pcall(function()
         if not _G.selectedItem or _G.selectedItem == "No items yet" or _G.selectedItem == "Waiting for new map..." then
            return
         end
         local gameFolder = workspace:FindFirstChild("Game")
         if not gameFolder then
            return
         end
         local map = gameFolder:FindFirstChild("Map")
         if not map then
            return
         end
         local itemFolder = map:FindFirstChild("Item")
         if not itemFolder then
            return
         end
         local item = itemFolder:FindFirstChild(_G.selectedItem)
         if not item or not item.Parent or item.Name == "SwappingPlots" then
            MapTab:CreateButton({Name="Refresh Items",Callback=function() end})() -- Auto-refresh
            return
         end
         local interactionHitbox = item:FindFirstChild("InteractionHitbox")
         if not interactionHitbox then
            return
         end
         local itemCFrame = interactionHitbox.CFrame
         local char = LocalPlayer.Character
         local hrp = char and char:FindFirstChild("HumanoidRootPart")
         if not hrp then
            return
         end
         hrp.CFrame = itemCFrame + Vector3.new(0, 6, 0) -- Offset by 6 studs upward
      end)
   end
})

-- === MORE TAB ===
ScriptTab:CreateButton({
   Name = "Infinite Yield",
   Callback = function()
      loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
   end
})
